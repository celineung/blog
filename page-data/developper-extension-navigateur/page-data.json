{"componentChunkName":"component---src-templates-post-js","path":"/developper-extension-navigateur","result":{"data":{"markdownRemark":{"html":"<p>Dans cet article, je vais m'intéresser au développement d'un addon Firefox et Chrome qui affiche une popup.</p>\n<p>Les API d'intéractions avec Chrome sont différents de ceux de Firefox. La première partie de cet article introduit la création d'un addon. Si ce qui vous intéresse est comment rendre l'addon compatible sur ces deux navigateurs, je vous invite à lire <a href=\"#chrome-firefox-api\">cette section</a>. </p>\n<p>Le code utilisé dans cet article se trouve <a href=\"https://github.com/celineung/poc-browser-addon\">ici</a>.</p>\n<h2>Écrire le manifest.json</h2>\n<p>Le fichier manifeste.json contient les métadonnées de l'addon (comme son nom et sa version), référence les scripts nécessaires à son lancement et les permissions accordées.</p>\n<p>Commençons par créer le dossier <strong>poc-browser-addon</strong> contenant ce manifest.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"POC Addon Popup\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Extension navigateur qui affiche une popup\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.1\"</span><span class=\"token punctuation\">,</span>\n  \n  <span class=\"token property\">\"background\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"background.js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  \n  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby-icon.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My Addon\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_popup\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"popup.html\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Le fichier background.js est un fichier qui sera lancé au chargement de l'extension. D'après <a href=\"https://developer.mozilla.org/fr/docs/Mozilla/Add-ons/WebExtensions/manifest.json/arriere-plan\">la documentation MDN</a>:</p>\n<blockquote>\n<p>Les scripts d'arrière-plan sont l'endroit pour placer le code qui doit maintenir l'état à long terme, ou effectuer des opérations à long terme, indépendamment de la durée de vie de toutes les pages Web ou les fenêtres du navigateur.</p>\n</blockquote>\n<p>La propriété \"browser_action\" permet de définir une icon à afficher sur le bouton de l'extension ainsi que une popup qui s'affiche lors d'un clic.</p>\n<h2>Lancer l'addon sur Chrome et Firefox</h2>\n<p>A cette étape, nous avons simplement initialisé l'addon avec le fichier manifest.json. L'addon n'est pas encore packagé et ne comporte aucune fonctionnalité pour le moment. Néanmoins, il est possible de le lancer localement sur son navigateur.</p>\n<p>Sur Chrome:</p>\n<ul>\n<li>Se rendre sur <a href=\"chrome://extensions\">chrome://extensions</a></li>\n<li>Activer le \"mode développeur\". Une nouvelle zone s'affiche et permet de sélectionner l'addon à charger.</li>\n<li>Cliquer sur \"Load unpacked\"</li>\n<li>Dans la popup qui s'ouvre, sélectionner le dossier <em>poc-browser-addon</em></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/24f59b246ef376a15c1979785c6985e9/3f99a/chrome_load_addon.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.783783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaUlEQVQI12OIarn3P6juzv+QeiBuuPc/uOrs/7CKA//DKg/9Dyg58D+geD+QRscH/vsX7/sfWH7sf1jjPSC++z+04e7/2LZ7/xk+fPn9/+2nX/8/fIHgL99////568//Hz//gGlSMEgPAOgSgjKVWSvmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Charger l&#39;addon sur Chrome\"\n        title=\"Charger l&#39;addon sur Chrome\"\n        src=\"/blog/static/24f59b246ef376a15c1979785c6985e9/fcda8/chrome_load_addon.png\"\n        srcset=\"/blog/static/24f59b246ef376a15c1979785c6985e9/12f09/chrome_load_addon.png 148w,\n/blog/static/24f59b246ef376a15c1979785c6985e9/e4a3f/chrome_load_addon.png 295w,\n/blog/static/24f59b246ef376a15c1979785c6985e9/fcda8/chrome_load_addon.png 590w,\n/blog/static/24f59b246ef376a15c1979785c6985e9/efc66/chrome_load_addon.png 885w,\n/blog/static/24f59b246ef376a15c1979785c6985e9/c83ae/chrome_load_addon.png 1180w,\n/blog/static/24f59b246ef376a15c1979785c6985e9/3f99a/chrome_load_addon.png 2840w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Et voilà! L'icône de notre addon s'affiche sur notre navigateur:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 140px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c577019f5c17b6092fa3a40b2766defa/0d3e1/chrome_addon_display.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSUlEQVQ4y71U3WvTUBTPX+Mf5AcMmcIeBGUg+DAQQfRBfKyGycZwDDcYW6tMUdnDNhWU6cuc2pag0jZpmmYJbZqs6XfT/sy5eq9ZP4ZO8MDJSc4993fO+d1zI/X7fZxESUrlCjI5HVm1IFTCP0q93oR36AuVWq0WSNvtNrOe68EpO3ArLprNpvAPaqPRYOtBEBxJIHW7XeakINMsolDUoGo56IYGwyiEFdTR6/XA48h2Oh22md45MKdCtGzbNlRVxeuNfTyd/4Dt+MfwW2NJgqA31OrnL0nxzqtmFdKjVqvDMHVsJ/YQu/wSN0/HcetMAst3X8E40BkNXA6rVcgP5jB16Qpi8my4t/aLy/rvCj3PQ17XsHR7B/MzW5g8JYeg67g3/QLflAwqFUcAUtsLi0s4O3EB585fxKOVVebnfDLAapiVKozff4vNxU94eGMH8vQmHsu7yGZzcF1XANIhybNzuHptBhOTU1hLPGF+4pK4lji5RdOAkvyO9dg7LFzfwvKdN9h/r4SJCix7tOWV1TU4TgUbz54faVlwyDOYB0Vomobk3lfkMipMywir94+dQ2qTTwIDpOzkoLZLpRLy+XzIpxpaDbZlM7/v+6xKUkpM8dySj4OxQ6EHbaKDofn6OchtZvlQO47D1iiWNnPlV5CDiZZpA+dglNCMEvgoid5tMTYESG1FA6KBlmWJwR33oxiqMAo42MYowHFy4gr/L2C5XD72UP4akEZGURSkUqkhTafT0HVd/Pf+CJCuHoFSpaOUhniQhnHyA74974MwDfAAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Affichage de l&#39;addon sur Chrome\"\n        title=\"Affichage de l&#39;addon sur Chrome\"\n        src=\"/blog/static/c577019f5c17b6092fa3a40b2766defa/0d3e1/chrome_addon_display.png\"\n        srcset=\"/blog/static/c577019f5c17b6092fa3a40b2766defa/0d3e1/chrome_addon_display.png 140w\"\n        sizes=\"(max-width: 140px) 100vw, 140px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>En cliquant sur l'addon, un petit carré blanc s'affiche: c'est normal, notre popup ne contient rien pour l'instant.</p>\n<blockquote>\n<p>Si l'extension ne s'affiche comme si l'image précédente, vous avez sûrement besoin de la fixer. Pour cela, cliquez sur l'icon de l'extension en forme de puzzle, visible sur l'image précédente.</p>\n</blockquote>\n<p>Sur firefox:</p>\n<ul>\n<li>Se rendre sur <a href=\"about:debugging#/runtime/this-firefox\">about:debugging#/runtime/this-firefox</a></li>\n<li>Cliquer sur \"Load temporary Add-on...\"</li>\n<li>Dans la fenêtre qui s'affiche, cliquer sur n'importe quel fichier du dossier <em>poc-browser-addon</em></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/8899fb1399857dd2bba79f43d7492ac6/3d22e/firefox_load_addon.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1UlEQVQoz1VTW46cMBDk/nfIf6ScIV+5wXxsohlNMpsdGIY12BiDH9hUum1YbZBKjU27qK5uV94HhBDhKDrn4QnOr1gBhLQhrhHrjhgT5a4lj/K9p1xXorUhv1fds0PbtgjelwQiC3aB+PYF/eUH7q1AUzd4PFrc7zWkVB+khbhEIUusbsLiTzdDTGFPCpl8/Pod0+UMZWaMasQ46kxmaO33atZQqutlhDYrVUMKtbFgTLPLZRf5Do9pRPN8R0vKmuaBvh+ysoMsUOzEjLda4verwlujMRmHykwGveihlMI8L5mMD0oikIPMyhQpdK7sH4gxomk1fp5rnC9/8fKrhtYWFX/kMgSRsgom5ed0OuF6vdJej657R0oJ27ZlogPbxnugswpP6gXvZUL25nZ7RU3mL4vdTXf0Xsj5YTJryR5NpU0TiTA5TmYiEXP+xnZU2Q8iOEbjWLNq7j6vmSzR3x113zsLOxuyo8coyRI5lKhkITxM/gwmZHXDMOQy+NEBGD2gCIPdIGbq7hLRzQliSRgIns79R3jM1FEy+8claj1BUmOECZCOBj5uWBMyLI3NQqO25AuyE37GcQu4/BDCx43g2Qy8RywpxWwBd8SQhwP9mMG5/wDImFGXuBT2VAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Charger un addon temporaire sur Firefox\"\n        title=\"Charger un addon temporaire sur Firefox\"\n        src=\"/blog/static/8899fb1399857dd2bba79f43d7492ac6/fcda8/firefox_load_addon.png\"\n        srcset=\"/blog/static/8899fb1399857dd2bba79f43d7492ac6/12f09/firefox_load_addon.png 148w,\n/blog/static/8899fb1399857dd2bba79f43d7492ac6/e4a3f/firefox_load_addon.png 295w,\n/blog/static/8899fb1399857dd2bba79f43d7492ac6/fcda8/firefox_load_addon.png 590w,\n/blog/static/8899fb1399857dd2bba79f43d7492ac6/efc66/firefox_load_addon.png 885w,\n/blog/static/8899fb1399857dd2bba79f43d7492ac6/c83ae/firefox_load_addon.png 1180w,\n/blog/static/8899fb1399857dd2bba79f43d7492ac6/3d22e/firefox_load_addon.png 2010w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Enrichir l'addon</h2>\n<p>Modifions le contenu de notre fichier popup.html:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fr<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Popup<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">></span></span>Saisir un message\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>message_id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>34<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Envoyer<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>popup.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Pour l'instant, ce message s'affichera à chaque clic sur l'addon. Notre objectif est de l'afficher tant qu'aucun message n'a été envoyé.</p>\n<p>Pour cela, une fois que l'utilisateur clique sur le bouton \"Envoyer\", l'état sera sauvegardé dans le storage de l'addon. Nous créons donc le fichier popup.js:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">MESSAGE_SELECTOR</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"#message_id\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">STORAGE_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"isMessageSent\"</span><span class=\"token punctuation\">;</span>\n\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"form\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"submit\"</span><span class=\"token punctuation\">,</span> setMessageInStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">setMessageInStorage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">[</span><span class=\"token constant\">STORAGE_KEY</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MESSAGE_SELECTOR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ferme la popup</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>L'utilisation du storage nécessite la permission dans le manifest.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"storage\"</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Côté background.js, nous avons besoin d'écouter sur les évènements du Storage. Lorsque un évènement a été délenché, nous récupérons la valeur dans le storage associé à la clé <code class=\"language-text\">isMessageSent</code>. S'il y a bien une valeur dans le storage alors la popup est cachée. Au prochain clic sur l'addon, la popup ne s'affichera plus.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">STORAGE_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"isMessageSent\"</span><span class=\"token punctuation\">;</span>\n\nchrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>onChanged<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>receiveEventFromStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">receiveEventFromStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STORAGE_KEY</span><span class=\"token punctuation\">,</span> keepPopupClosedAndEnableAddon<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">keepPopupClosedAndEnableAddon</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> isMessageSent <span class=\"token operator\">=</span> result<span class=\"token punctuation\">[</span><span class=\"token constant\">STORAGE_KEY</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isMessageSent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        chrome<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span><span class=\"token function\">setPopup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            popup<span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Inspecter l'addon</h2>\n<p>Pour aller plus loin, nous pouvons afficher un <code class=\"language-text\">console.log</code> dans le background.js qui sera déclenché à chaque clic sur l'addon. Cet évènement ne sera <strong>pas déclenché tant que la popup sera active</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">chrome<span class=\"token punctuation\">.</span>browserAction<span class=\"token punctuation\">.</span>onClicked<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>displayConsoleLog<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">displayConsoleLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Voilà'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Pour inspecter l'addon sur Chrome: se rendre sur <a href=\"chrome://extensions\">chrome://extensions</a> et cliquer sur \"background page\" de notre addon. Une nouvelle fenêtre s'ouvre. Dans l'onglet \"console\", le message \"Voilà\" de notre script s'affiche.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ffa5e61fa5f8d31bc45c1614918d7371/6a6e9/chrome_inspect_addon.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxklEQVQoz5VSy27UQBDcT+TAFcRplR+AG3wDJy58AERIgRNiLwgp5IYSIZQILt6X17trrx9je8beeVW6bWdJUARi5FL3THeXq3tm1O73uFneOWhjYK2D8x70wTmyFLPWwhgLrTXB3IXpsafYiImmQYCPnybIyoqKDJbLEGHIWCGKIkSrCHlRoJYSf1uOBHWE705O8OThA0zPPndqZrM5lkS4Xm860iCYIk4S7HbpAQX9IMvyDqweQxcjT32t4h2uJh+gv7z3HCpF6UiNbttWV1WthSg179lnlFWl61rSubCFEEzkD4Tc+0Fy7zv83zrkd4Q8aFbJ/XOQh04X9Y38Z4QXhOf3gM79U6o79t3leXeLsFfIASZUSmGxWJ6uN9vHabI5Ov+1Hb+aJOO3p+n4+Gs6fsP2LD3KpXlE+a8HQntH4S1CPnTbOEaW5xBFjnBb4CJQuJwr/AwbXC0UfswUWu2GOn5h/nfL/I64XVZN1vO7G+Zi/gFN+bavJYluIHTWYJVbXMw1kpJvyyHKrf++0H6WGO/6P9yLNM280S3WAv7lRCCrDEZSKlS1QiZ6yzO82RelgqR907SE5g+0XS77tWwQZ5KswjXloEWmkMLBMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Inspecter l&#39;addon sur Chrome\"\n        title=\"Inspecter l&#39;addon sur Chrome\"\n        src=\"/blog/static/ffa5e61fa5f8d31bc45c1614918d7371/fcda8/chrome_inspect_addon.png\"\n        srcset=\"/blog/static/ffa5e61fa5f8d31bc45c1614918d7371/12f09/chrome_inspect_addon.png 148w,\n/blog/static/ffa5e61fa5f8d31bc45c1614918d7371/e4a3f/chrome_inspect_addon.png 295w,\n/blog/static/ffa5e61fa5f8d31bc45c1614918d7371/fcda8/chrome_inspect_addon.png 590w,\n/blog/static/ffa5e61fa5f8d31bc45c1614918d7371/6a6e9/chrome_inspect_addon.png 826w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Pour inspecter l'addon sur Firefox, se rendre sur <a href=\"about:debugging#/runtime/this-firefox\">about:debugging#/runtime/this-firefox</a> et Cliquer sur le bouton \"Inspect\" de l'addon concerné. Un nouvel onglet s'ouvre. Dans l'onglet \"console\", le message \"Voilà\" de notre script s'affiche.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ea4a64311026b00910323048357b1e46/e8814/firefox_inspect_addon.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABi0lEQVQoz32Si26zMAyFef+H6cus7dZdy6hUlQIJ11xIcmZ7oqy/qh/pU+yYHOxDsqI44eXlgN1uj7e3d+z3z8LHxyeu1wrez7DWwTl/g3Nj7EOyaTJy6N8C7zN8+BF5/o2npy222500dDi8SgNZCBGn0wlNo9D3PbquE7z3iDEihPCQtVODuq4F6TClhM1mQyPvcD6fwRbkeY5hGMAP1//3sHhRFIJzDtk8Bwm01ncvLkJca9uWuu5vK0/wG3c01YBxHKUBEeQv8IZSmkawIvRXjG1YrFhiPrzEfHYy7PckNomH/DKPy12uggkxzPDWYPYOs7NwFGvVoNMKLdG3Gi3lvKeamup2FbxcLjLGYpkNCb0HhhmydkRrI66dQdVbwqHsGCt7jHHzOnLTNLLyn2V6F3AdGRKZEsoxQdkE7SA0FqgMUNOqKFf0QevjKliWJXVZoqpqgXPdVKgGh8tEfoZfG+5IEYlsIW/EHtbK+FIvvvG49/GSx1vncjcJrvHFPx5zVHQHv76Okv8AdflR0t2Ca2MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Inspecter l&#39;addon sur Firefox\"\n        title=\"Inspecter l&#39;addon sur Firefox\"\n        src=\"/blog/static/ea4a64311026b00910323048357b1e46/fcda8/firefox_inspect_addon.png\"\n        srcset=\"/blog/static/ea4a64311026b00910323048357b1e46/12f09/firefox_inspect_addon.png 148w,\n/blog/static/ea4a64311026b00910323048357b1e46/e4a3f/firefox_inspect_addon.png 295w,\n/blog/static/ea4a64311026b00910323048357b1e46/fcda8/firefox_inspect_addon.png 590w,\n/blog/static/ea4a64311026b00910323048357b1e46/efc66/firefox_inspect_addon.png 885w,\n/blog/static/ea4a64311026b00910323048357b1e46/c83ae/firefox_inspect_addon.png 1180w,\n/blog/static/ea4a64311026b00910323048357b1e46/e8814/firefox_inspect_addon.png 1392w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"chrome-firefox-api\">Utiliser une seule API pour Chrome et Firefox</h2>\n<p>Si l'on considère l'<a href=\"https://developer.chrome.com/docs/extensions/reference/storage/\">API Chromium pour le storage</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>key<span class=\"token operator\">:</span> value<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> callbackFunction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Alors que pour Firefox, l'<a href=\"https://developer.mozilla.org/fr/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/set\">API retourne une Promesse</a> (donc pas besoin de lui fournir une fonction callback):</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">browser<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>keys <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Toutefois, Firefox comprend l'API Chromium mais pas l'inverse. C'est pourquoi nous utilisons uniquement l'API Chronium.</p>","excerpt":"Dans cet article, je vais m'intéresser au développement d'un addon Firefox et Chrome qui affiche une popup. Les API d'intéractions avec…","frontmatter":{"date":"2021-03-15","slug":"developper-extension-navigateur","title":"Développer une extension navigateur ","illustration":{"childImageSharp":{"resize":{"src":"/static/d02ca0754060322c320c4810cdc1fe4b/47498/desk-flat-lay-complete-with-coffee.jpg","height":800,"width":1200}}}}}},"pageContext":{"slug":"developper-extension-navigateur"}},"staticQueryHashes":["3649515864","764694655"]}